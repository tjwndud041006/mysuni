{"ast":null,"code":"// follow our trie structure\nconst scanWords = function (terms, trie, opts) {\n  let n = 0;\n  let results = [];\n  for (let i = 0; i < terms.length; i++) {\n    let word = terms[i][opts.form] || terms[i].normal;\n    // main match-logic loop:\n    while (n > 0 && (trie.goNext[n] === undefined || !trie.goNext[n].hasOwnProperty(word))) {\n      n = trie.failTo[n] || 0; // (usually back to 0)\n    }\n    // did we fail?\n    if (!trie.goNext[n].hasOwnProperty(word)) {\n      continue;\n    }\n    n = trie.goNext[n][word];\n    if (trie.endAs[n]) {\n      let arr = trie.endAs[n];\n      for (let o = 0; o < arr.length; o++) {\n        let len = arr[o];\n        let term = terms[i - len + 1];\n        let [no, start] = term.index;\n        results.push([no, start, start + len, term.id]);\n      }\n    }\n  }\n  return results;\n};\nconst cacheMiss = function (words, cache) {\n  for (let i = 0; i < words.length; i += 1) {\n    if (cache.has(words[i]) === true) {\n      return false;\n    }\n  }\n  return true;\n};\nconst scan = function (view, trie, opts) {\n  let results = [];\n  opts.form = opts.form || 'normal';\n  let docs = view.docs;\n  if (!trie.goNext || !trie.goNext[0]) {\n    console.error('Compromise invalid lookup trie'); //eslint-disable-line\n    return view.none();\n  }\n  let firstWords = Object.keys(trie.goNext[0]);\n  // do each phrase\n  for (let i = 0; i < docs.length; i++) {\n    // can we skip the phrase, all together?\n    if (view._cache && view._cache[i] && cacheMiss(firstWords, view._cache[i]) === true) {\n      continue;\n    }\n    let terms = docs[i];\n    let found = scanWords(terms, trie, opts);\n    if (found.length > 0) {\n      results = results.concat(found);\n    }\n  }\n  return view.update(results);\n};\nexport default scan;","map":{"version":3,"names":["scanWords","terms","trie","opts","n","results","i","length","word","form","normal","goNext","undefined","hasOwnProperty","failTo","endAs","arr","o","len","term","no","start","index","push","id","cacheMiss","words","cache","has","scan","view","docs","console","error","none","firstWords","Object","keys","_cache","found","concat","update"],"sources":["/Users/seojuyoung/sunic/project/frontend/node_modules/compromise/src/1-one/lookup/api/scan.js"],"sourcesContent":["// follow our trie structure\nconst scanWords = function (terms, trie, opts) {\n  let n = 0\n  let results = []\n  for (let i = 0; i < terms.length; i++) {\n    let word = terms[i][opts.form] || terms[i].normal\n    // main match-logic loop:\n    while (n > 0 && (trie.goNext[n] === undefined || !trie.goNext[n].hasOwnProperty(word))) {\n      n = trie.failTo[n] || 0 // (usually back to 0)\n    }\n    // did we fail?\n    if (!trie.goNext[n].hasOwnProperty(word)) {\n      continue\n    }\n    n = trie.goNext[n][word]\n    if (trie.endAs[n]) {\n      let arr = trie.endAs[n]\n      for (let o = 0; o < arr.length; o++) {\n        let len = arr[o]\n        let term = terms[i - len + 1]\n        let [no, start] = term.index\n        results.push([no, start, start + len, term.id])\n      }\n    }\n  }\n  return results\n}\n\nconst cacheMiss = function (words, cache) {\n  for (let i = 0; i < words.length; i += 1) {\n    if (cache.has(words[i]) === true) {\n      return false\n    }\n  }\n  return true\n}\n\nconst scan = function (view, trie, opts) {\n  let results = []\n  opts.form = opts.form || 'normal'\n  let docs = view.docs\n  if (!trie.goNext || !trie.goNext[0]) {\n    console.error('Compromise invalid lookup trie')//eslint-disable-line\n    return view.none()\n  }\n  let firstWords = Object.keys(trie.goNext[0])\n  // do each phrase\n  for (let i = 0; i < docs.length; i++) {\n    // can we skip the phrase, all together?\n    if (view._cache && view._cache[i] && cacheMiss(firstWords, view._cache[i]) === true) {\n      continue\n    }\n    let terms = docs[i]\n    let found = scanWords(terms, trie, opts)\n    if (found.length > 0) {\n      results = results.concat(found)\n    }\n  }\n  return view.update(results)\n}\nexport default scan\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}